sequenceDiagram
    autonumber

    %% ======================
    %% ACTORS & SERVICES
    %% ======================
    actor Passenger as Passenger App
    participant Gateway as API Gateway
    participant Auth as Auth Service
    participant DB as Auth DB
    participant Service as Protected Service<br/>(Trip / Matching / Profile)

    %% ======================
    %% LOGIN FLOW
    %% ======================
    rect rgb(235,245,255)
        Passenger->>Gateway: POST /auth/login<br/>{email, password}
        Gateway->>Auth: POST /auth/login<br/>{email, password}

        Auth->>DB: SELECT user WHERE email = ?
        DB-->>Auth: user(id, password_hash)

        Auth->>Auth: verify_password()
        Auth->>Auth: create JWT access_token

        Auth-->>Gateway: 200 OK<br/>{access_token}
        Gateway-->>Passenger: 200 OK<br/>{access_token}
    end

    %% ======================
    %% PROTECTED REQUEST FLOW
    %% ======================
    rect rgb(245,255,235)
        Passenger->>Gateway: GET /trips/active<br/>Authorization: Bearer JWT

        Gateway->>Gateway: Extract Authorization header
        Note right of Gateway: Gateway does NOT validate JWT (MVP)

        Gateway->>Service: GET /trips/active<br/>Authorization: Bearer JWT

        Service->>Service: (optional) Validate JWT<br/>(later phase)

        Service-->>Gateway: 200 OK<br/>{trip_data}
        Gateway-->>Passenger: 200 OK<br/>{trip_data}
    end
